<!doctype html>
<html>
<head><meta charset="utf-8" /><title>Orbit Admin</title></head>
<body>
  <h1>Orbit Admin Dashboard</h1>
  <a href="/logout">Logout</a>

  <hr/>

  <h2>Add Client (Manual)</h2>
  <form method="post" action="/admin/clients/add">
    <input name="name" placeholder="Client Name" required />
    <input name="code" placeholder="Client Code (e.g. sofia1)" required />
    <input name="email" placeholder="Client Email" required />
    <input name="bookingLink" placeholder="Booking Link (optional)" />
    <button type="submit">Add</button>
  </form>

  <p><b>Client lead form:</b> https://YOURDOMAIN/c/CLIENTCODE</p>

  <hr/>

  <h2>Client Intake Requests (Clients submit here: <a href="/intake">/intake</a>)</h2>
  <table border="1" cellpadding="6">
    <tr><th>Business</th><th>Contact</th><th>Email</th><th>Booking</th><th>Action</th></tr>
    <% intake.forEach(r => { %>
      <tr>
        <td><%= r.business %></td>
        <td><%= r.contact %></td>
        <td><%= r.email %></td>
        <td><%= r.bookingLink || "-" %></td>
        <td>
          <% if (r.status === "NEW") { %>
            <form method="post" action="/admin/intake/<%= r.id %>/approve">
              <input name="code" placeholder="Assign Client Code (e.g. sofia1)" required />
              <button type="submit">Approve → Create Client</button>
            </form>
          <% } else { %>
            <%= r.status %>
          <% } %>
        </td>
      </tr>
    <% }) %>
  </table>

  <hr/>

  <h2>Clients</h2>
  <table border="1" cellpadding="6">
    <tr>
      <th>Name</th><th>Code</th><th>Email</th><th>Status</th><th>Days Left</th><th>Due Date</th><th>Lead Form</th><th>Booking</th><th>Actions</th>
    </tr>

    <% clients.forEach(c => { %>
      <tr>
        <td><%= c.name %></td>
        <td><%= c.code %></td>
        <td><%= c.email %></td>
        <td><%= c.status %></td>
        <td><%= (c.daysLeft === null ? "-" : c.daysLeft) %></td>
        <td><%= c.dueDate || "-" %></td>
        <td><a href="/c/<%= c.code %>" target="_blank">/c/<%= c.code %></a></td>
        <td><%= c.bookingLink || "-" %></td>
        <td>
          <% if (c.status === "ACTIVE") { %>
            <form method="post" action="/admin/clients/<%= c.id %>/pause" style="display:inline;">
              <button type="submit">Pause</button>
            </form>
          <% } %>

          <% if (c.status === "PAUSED") { %>
            <form method="post" action="/admin/clients/<%= c.id %>/paid" style="display:inline;">
              <button type="submit">Mark Paid → Reactivate</button>
            </form>
          <% } %>
        </td>
      </tr>
    <% }) %>
  </table>

  <hr/>

  <h2>Latest Leads</h2>
  <table border="1" cellpadding="6">
    <tr><th>Client</th><th>Name</th><th>Email</th><th>Phone</th><th>Message</th><th>Date</th></tr>
    <% leads.forEach(l => { %>
      <tr>
        <td><%= l.client ? l.client.code : "-" %></td>
        <td><%= l.name %></td>
        <td><%= l.email %></td>
        <td><%= l.phone || "-" %></td>
        <td><%= l.message || "-" %></td>
        <td><%= new Date(l.createdAt).toISOString().slice(0,19).replace("T"," ") %></td>
      </tr>
    <% }) %>
  </table>
</body>
</html>
